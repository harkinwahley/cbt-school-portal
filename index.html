<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excellence Academy CBT Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #006b3c; /* JAMB Green */
            --secondary: #e9f7ef;
            --accent: #d35400;
            --text: #333;
            --white: #ffffff;
        }

        body {
            font-family: 'Comic Neue', cursive; /* Kept your preferred font */
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: var(--white);
            width: 90%;
            max-width: 600px;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 5px solid var(--primary);
        }

        h1, h2 { color: var(--primary); margin-bottom: 20px; }
        
        /* Inputs */
        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        /* Buttons */
        .btn {
            background-color: var(--primary);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: 0.3s;
            margin: 5px;
        }
        .btn:hover { background-color: #00502b; }
        .btn-secondary { background-color: #555; }
        .btn-subject { width: 100%; margin: 10px 0; padding: 15px; font-size: 18px; }

        /* Timer */
        #timer-box {
            background: var(--accent);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 20px;
        }

        /* Questions */
        .option-label {
            display: block;
            background: var(--secondary);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            border: 1px solid #cce5d9;
            transition: 0.2s;
        }
        .option-label:hover { background: #d4efdf; }
        input[type="radio"] { width: auto; margin-right: 10px; }
        input[type="radio"]:checked + span { font-weight: bold; color: var(--primary); }

        /* Layout Utilities */
        .hidden { display: none; }
        .nav-btns { display: flex; justify-content: space-between; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="section-register" class="container">
        <h1>ðŸŽ“ Excellence Academy</h1>
        <p>CBT Practice Portal</p>
        <input type="text" id="reg-name" placeholder="Enter Full Name">
        <input type="text" id="reg-class" placeholder="Class (e.g., SS3)">
        <button class="btn" onclick="registerStudent()">Start Registration</button>
    </div>

    <div id="section-dashboard" class="container hidden">
        <h2 id="welcome-msg">Welcome</h2>
        <p>Select a subject to begin practice:</p>
        <button class="btn btn-subject" onclick="startExam('math')">ðŸ§® Mathematics (10 Questions)</button>
        <button class="btn btn-subject" onclick="startExam('english')">ðŸ“– English Language (10 Questions)</button>
    </div>

    <div id="section-exam" class="container hidden">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <span id="subject-title" style="font-weight:bold; color:var(--primary)"></span>
            <div id="timer-box">Time: <span id="time-left">05:00</span></div>
        </div>
        
        <div id="question-container">
            <h3 id="q-text">Question goes here...</h3>
            <div id="options-container">
                </div>
        </div>

        <div class="nav-btns">
            <button class="btn btn-secondary" onclick="prevQuestion()">Previous</button>
            <div id="q-status">1 of 10</div>
            <button class="btn" id="btn-next" onclick="nextQuestion()">Next</button>
        </div>
    </div>

    <div id="section-result" class="container hidden">
        <h2>ðŸŽ‰ Exam Submitted!</h2>
        <p>Student: <b id="res-name"></b></p>
        <p>Subject: <b id="res-subject"></b></p>
        <div style="font-size: 40px; color: var(--primary); margin: 20px 0;">
            <span id="res-score">0</span> / <span id="res-total">0</span>
        </div>
        <p id="res-percent"></p>
        <button class="btn" onclick="location.reload()">Back to Home</button>
    </div>

    <script src="questions.js"></script> 
    
    <script>
        // -- STATE MANAGEMENT --
        let currentUser = {};
        let currentSubject = '';
        let currentQuestions = [];
        let userAnswers = []; // Stores index of selected options
        let currentQIndex = 0;
        let timerInterval;

        // -- REGISTRATION --
        function registerStudent() {
            const name = document.getElementById('reg-name').value;
            if(!name) return alert("Please enter your name");
            
            currentUser = { name: name, id: Date.now() };
            document.getElementById('welcome-msg').innerText = `Welcome, ${name}`;
            
            switchSection('section-dashboard');
        }

        // -- START EXAM --
       function startExam(subject) {
    console.log("Starting exam for subject:", subject); 

    currentSubject = subject;
    
    // OLD WAY: currentQuestions = questionBank[subject];
    
    // NEW WAY: Shuffle the questions before assigning them!
    const allQuestions = questionBank[subject];
    
    if (!allQuestions) {
        alert("Error: Subject data not found!");
        return;
    }

    // 1. Shuffle the questions
    let shuffledQuestions = shuffleArray(allQuestions);

    // 2. (Optional) Limit to 10 questions. 
    // This is great if your bank has 100 questions but you only want a 10-question test.
    // If you want ALL questions, just remove .slice(0, 10)
    currentQuestions = shuffledQuestions.slice(0, 10);

    userAnswers = new Array(currentQuestions.length).fill(null);
    currentQIndex = 0;

    document.getElementById('subject-title').innerText = subject.toUpperCase();
    
    switchSection('section-exam');
    loadQuestion(0);
    startTimer(10 * 60); 
}

        // -- RENDER QUESTION --
        function loadQuestion(index) {
            const q = currentQuestions[index];
            document.getElementById('q-text').innerText = `${index + 1}. ${q.question}`;
            document.getElementById('q-status').innerText = `${index + 1} of ${currentQuestions.length}`;

            const optsDiv = document.getElementById('options-container');
            optsDiv.innerHTML = ''; // Clear old options

            q.options.forEach((opt, i) => {
                const checked = userAnswers[index] === i ? 'checked' : '';
                optsDiv.innerHTML += `
                    <label class="option-label">
                        <input type="radio" name="option" value="${i}" onclick="saveAnswer(${i})" ${checked}>
                        <span>${opt}</span>
                    </label>
                `;
            });

            // Update Next Button Text
            const nextBtn = document.getElementById('btn-next');
            nextBtn.innerText = (index === currentQuestions.length - 1) ? "Submit Exam" : "Next";
            nextBtn.onclick = (index === currentQuestions.length - 1) ? submitExam : nextQuestion;
        }

        // -- NAVIGATION --
        function saveAnswer(optionIndex) {
            userAnswers[currentQIndex] = optionIndex;
        }

        function nextQuestion() {
            if(currentQIndex < currentQuestions.length - 1) {
                currentQIndex++;
                loadQuestion(currentQIndex);
            }
        }

        function prevQuestion() {
            if(currentQIndex > 0) {
                currentQIndex--;
                loadQuestion(currentQIndex);
            }
        }

        // -- TIMER --
        function startTimer(duration) {
            let timer = duration, minutes, seconds;
            const display = document.getElementById('time-left');
            
            clearInterval(timerInterval); // Clear any existing timer
            timerInterval = setInterval(function () {
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);

                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;

                display.textContent = minutes + ":" + seconds;

                if (--timer < 0) {
                    submitExam();
                }
            }, 1000);
        }

        // -- SUBMIT & SCORING --
        function submitExam() {
            clearInterval(timerInterval);
            let score = 0;
            
            // Calculate Score
            currentQuestions.forEach((q, index) => {
                if(userAnswers[index] === q.answer) {
                    score++;
                }
            });

            // Show Results
            document.getElementById('res-name').innerText = currentUser.name;
            document.getElementById('res-subject').innerText = currentSubject.toUpperCase();
            document.getElementById('res-score').innerText = score;
            document.getElementById('res-total').innerText = currentQuestions.length;
            
            const percentage = (score / currentQuestions.length) * 100;
            document.getElementById('res-percent').innerText = `${percentage}%`;
            document.getElementById('res-percent').style.color = percentage >= 50 ? 'green' : 'red';

            // SAVE TO DATABASE (LocalStorage for Admin)
            saveToAdmin(currentUser.name, currentSubject, score, percentage);

            switchSection('section-result');
        }

        function saveToAdmin(name, subject, score, percent) {
            const resultData = {
                name: name,
                subject: subject,
                score: score,
                percent: percent,
                date: new Date().toLocaleString()
            };
            
            let allResults = JSON.parse(localStorage.getItem('schoolResults') || "[]");
            allResults.push(resultData);
            localStorage.setItem('schoolResults', JSON.stringify(allResults));
        }

        // -- UTILITY --
        function switchSection(id) {
            document.querySelectorAll('.container').forEach(div => div.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

// --- UTILITY: SHUFFLE FUNCTION ---
function shuffleArray(array) {
    // This creates a copy so we don't mess up the original bank
    let shuffled = [...array]; 
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}

    </script>
</body>
</html>
