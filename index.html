<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excellence Academy CBT Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #006b3c; --secondary: #e9f7ef; --accent: #d35400; --white: #ffffff; }
        body { font-family: 'Comic Neue', cursive; background-color: #f4f4f4; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { background: var(--white); width: 90%; max-width: 600px; padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; border-top: 5px solid var(--primary); }
        h1, h2 { color: var(--primary); margin-top: 0; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
        .btn { background-color: var(--primary); color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin: 5px; font-size: 16px; }
        .btn-subject { width: 100%; margin: 10px 0; padding: 15px; font-size: 18px; }
        #timer-box { background: var(--accent); color: white; padding: 10px; border-radius: 5px; margin-bottom: 20px; display: inline-block; font-weight: bold; }
        
        /* Question Styling */
        #q-text { text-align: left; margin-bottom: 20px; line-height: 1.5; color: #333; font-size: 1.1rem; }
        .option-label { display: flex; align-items: center; background: var(--secondary); padding: 15px; margin: 10px 0; border-radius: 8px; cursor: pointer; text-align: left; border: 1px solid #cce5d9; transition: 0.2s; }
        .option-label:hover { background: #d4efdf; }
        .option-label input { width: auto; margin: 0 15px 0 0; cursor: pointer; transform: scale(1.2); }
        
        .hidden { display: none; }
        .nav-btns { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
        .admin-link { margin-top: 20px; font-size: 12px; color: #bbb; text-decoration: none; display: block; }
    </style>
</head>
<body>

    <div id="section-register" class="container">
        <h1>ðŸŽ“ Excellence Academy</h1>
        <p>Student Registration</p>
        <input type="text" id="reg-name" placeholder="Enter Full Name">
        <input type="text" id="reg-class" placeholder="Enter Class (e.g. SS3)">
        <button class="btn" onclick="registerStudent()">Start Examination</button>
        <a href="admin.html" class="admin-link">Staff Login</a>
    </div>

    <div id="section-dashboard" class="container hidden">
        <h2 id="welcome-msg">Welcome</h2>
        <p>Choose your subject to begin:</p>
        <button class="btn btn-subject" onclick="startExam('math')">ðŸ§® Mathematics</button>
        <button class="btn btn-subject" onclick="startExam('english')">ðŸ“– English Language</button>
    </div>

    <div id="section-exam" class="container hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <span id="subject-title" style="font-weight:bold; color:var(--primary)"></span>
            <div id="timer-box">Time: <span id="time-left">10:00</span></div>
        </div>
        <div id="question-container">
            <h3 id="q-text"></h3>
            <div id="options-container"></div>
        </div>
        <div class="nav-btns">
            <button class="btn" style="background:#555" onclick="prevQuestion()">Previous</button>
            <div id="q-status" style="font-weight: bold;"></div>
            <button class="btn" id="btn-next" onclick="nextQuestion()">Next</button>
        </div>
    </div>

    <div id="section-result" class="container hidden">
        <h2>ðŸŽ‰ Submission Successful!</h2>
        <p id="res-name-display"></p>
        <div style="font-size: 40px; color: var(--primary); margin: 20px 0;">
            Score: <span id="res-score"></span> / 10
        </div>
        <p>Record uploaded to cloud successfully.</p>
        <button class="btn" onclick="location.reload()">Finish</button>
    </div>

    <script src="questions.js"></script>
    <script>
        const FIREBASE_URL = "https://excellencecbt-577fb-default-rtdb.firebaseio.com/results.json";
        
        let currentUser = "", currentClass = "", currentSubject = "", currentQuestions = [], userAnswers = [], currentQIndex = 0, timerInterval;

        function switchSection(id) {
            document.querySelectorAll('.container').forEach(div => div.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        function registerStudent() {
            const name = document.getElementById('reg-name').value;
            const sClass = document.getElementById('reg-class').value;
            if(!name || !sClass) return alert("Please fill in all fields");
            currentUser = name;
            currentClass = sClass;
            document.getElementById('welcome-msg').innerText = `Welcome, ${name} (${sClass})`;
            switchSection('section-dashboard');
        }

        function startExam(subj) {
            currentSubject = subj;
            currentQuestions = [...questionBank[subj]].sort(() => 0.5 - Math.random()).slice(0, 10);
            userAnswers = new Array(10).fill(null);
            currentQIndex = 0;
            document.getElementById('subject-title').innerText = subj.toUpperCase();
            switchSection('section-exam');
            loadQuestion(0);
            startTimer(600);
        }

        function loadQuestion(index) {
            const q = currentQuestions[index];
            document.getElementById('q-text').innerText = (index + 1) + ". " + q.question;
            document.getElementById('q-status').innerText = (index + 1) + " of 10";
            
            const optsDiv = document.getElementById('options-container');
            optsDiv.innerHTML = '';
            
            q.options.forEach((opt, i) => {
                const label = document.createElement('label');
                label.className = 'option-label';
                label.innerHTML = `<input type="radio" name="opt" ${userAnswers[index] === i ? 'checked' : ''}> <span>${opt}</span>`;
                label.onclick = () => { userAnswers[index] = i; };
                optsDiv.appendChild(label);
            });
            
            document.getElementById('btn-next').innerText = index === 9 ? "Submit Exam" : "Next";
        }

        function nextQuestion() {
            if(currentQIndex < 9) { currentQIndex++; loadQuestion(currentQIndex); }
            else { submitExam(); }
        }

        function prevQuestion() { if(currentQIndex > 0) { currentQIndex--; loadQuestion(currentQIndex); } }

        function startTimer(t) {
            timerInterval = setInterval(() => {
                let m = Math.floor(t/60), s = t%60;
                document.getElementById('time-left').innerText = `${m}:${s<10?'0':''}${s}`;
                if(--t < 0) submitExam();
            }, 1000);
        }

        async function submitExam() {
            clearInterval(timerInterval);
            let score = 0;
            currentQuestions.forEach((q, i) => { if(userAnswers[i] === q.answer) score++; });
            
            const resultData = { 
                name: currentUser, 
                class: currentClass,
                subject: currentSubject, 
                score: score, 
                percent: score * 10, 
                date: new Date().toLocaleString() 
            };

            try {
                await fetch(FIREBASE_URL, { method: "POST", body: JSON.stringify(resultData) });
            } catch (e) { console.error("Cloud save failed", e); }

            document.getElementById('res-name-display').innerText = currentUser + " (" + currentClass + ")";
            document.getElementById('res-score').innerText = score;
            switchSection('section-result');
        }
    </script>
</body>
</html>
