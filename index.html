<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excellence Academy CBT Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #006b3c; --secondary: #e9f7ef; --accent: #d35400; --text: #333; --white: #ffffff; }
        body { font-family: 'Roboto', sans-serif; background-color: #f4f4f4; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { background: var(--white); width: 95%; max-width: 650px; padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; border-top: 6px solid var(--primary); }
        .hidden { display: none; }
        h1 { font-family: 'Comic Neue', cursive; color: var(--primary); cursor: default; user-select: none; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
        .btn { background-color: var(--primary); color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin: 5px; font-size: 16px; transition: 0.2s; }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-subject { width: 100%; margin: 5px 0; padding: 15px; font-size: 16px; text-align: left; display: flex; align-items: center; background: #fff; color: var(--text); border: 1px solid #ddd; }
        .btn-subject:hover { background: var(--secondary); border-color: var(--primary); }
        .option-label { display: flex; align-items: center; background: var(--secondary); padding: 15px; margin: 10px 0; border-radius: 8px; cursor: pointer; text-align: left; border: 1px solid #cce5d9; }
        .option-label input[type="radio"] { margin-right: 15px; width: 20px; height: 20px; flex-shrink: 0; }
        #timer-box { background: var(--accent); color: white; padding: 8px 15px; border-radius: 5px; font-weight: bold; font-size: 18px; }
        .nav-btns { display: flex; justify-content: space-between; align-items: center; margin-top: 25px; }
        #feedback-box { text-align: left; background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px; border: 1px solid #ffeeba; }
    </style>
</head>
<body>

    <div id="section-register" class="container">
        <h1 id="admin-trigger" onclick="secretAdminTap()">ğŸ“ Excellence Academy</h1>
        <p>JAMB Practice Portal | 20 Questions | 10 Mins</p>
        <input type="text" id="reg-name" placeholder="Enter Full Name">
        <input type="text" id="reg-class" placeholder="Class (e.g., SS3)">
        <button class="btn" onclick="registerStudent()">Start Practice</button>
    </div>

    <div id="section-dashboard" class="container hidden">
        <h2 id="welcome-msg">Welcome</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <button class="btn btn-subject" onclick="startExam('math')">ğŸ§® Mathematics</button>
            <button class="btn btn-subject" onclick="startExam('english')">ğŸ“– English</button>
            <button class="btn btn-subject" onclick="startExam('physics')">âš›ï¸ Physics</button>
            <button class="btn btn-subject" onclick="startExam('chemistry')">ğŸ§ª Chemistry</button>
            <button class="btn btn-subject" onclick="startExam('biology')">ğŸ§¬ Biology</button>
            <button class="btn btn-subject" onclick="startExam('government')">ğŸ›ï¸ Government</button>
            <button class="btn btn-subject" onclick="startExam('economics')">ğŸ“ˆ Economics</button>
            <button class="btn btn-subject" onclick="startExam('commerce')">ğŸ›’ Commerce</button>
            <button class="btn btn-subject" onclick="startExam('accounting')">ğŸ’° Accounting</button>
            <button class="btn btn-subject" onclick="startExam('literature')">ğŸ“š Literature</button>
            <button class="btn btn-subject" onclick="startExam('crs')">âœï¸ CRS</button>
        </div>
    </div>

    <div id="section-exam" class="container hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom:20px;">
            <span id="subject-title" style="font-weight:bold; color:var(--primary); font-size: 20px;"></span>
            <div id="timer-box">â³ <span id="time-left">10:00</span></div>
        </div>
        <div id="question-area">
            <h3 id="q-text" style="text-align: left; margin-bottom: 20px;"></h3>
            <div id="options-container"></div>
        </div>
        <div class="nav-btns">
            <button class="btn" style="background:#555" onclick="prevQuestion()">Back</button>
            <div id="q-status" style="font-weight: bold;"></div>
            <button class="btn" id="btn-next" onclick="nextQuestion()">Next</button>
        </div>
    </div>

    <div id="section-result" class="container hidden">
        <h2>ğŸ“Š Performance Report</h2>
        <p>Student: <b id="res-name"></b> | Subject: <b id="res-subject"></b></p>
        <div style="font-size: 50px; color: var(--primary); margin: 15px 0; font-weight: bold;"><span id="res-score">0</span> / 20</div>
        <p id="res-percent" style="font-weight:bold; font-size: 24px;"></p>
        <div id="feedback-box" class="hidden">
            <h4 style="margin: 0 0 10px 0; color: #856404;">ğŸ” Topics for Revision:</h4>
            <ul id="topic-suggestions" style="margin: 0; padding-left: 20px; line-height: 1.8;"></ul>
        </div>
        <button class="btn" onclick="location.reload()">New Practice</button>
    </div>

    <script src="questions.js"></script>
    <script>
        let currentUser = {}, currentSubject = '', currentQuestions = [], userAnswers = [], currentQIndex = 0;
        let timerInterval, startTime, timeTakenSec;

        // Secret Admin Trigger
        let tapCount = 0;
        function secretAdminTap() {
            tapCount++;
            if (tapCount === 5) { window.location.href = 'admin.html'; tapCount = 0; }
            setTimeout(() => { tapCount = 0; }, 3000);
        }

        function registerStudent() {
            const name = document.getElementById('reg-name').value;
            const cls = document.getElementById('reg-class').value;
            if(!name || !cls) return alert("Enter Name and Class");
            currentUser = { name, class: cls };
            document.getElementById('welcome-msg').innerText = `Hello, ${name}`;
            switchSection('section-dashboard');
        }

        function startExam(subject) {
            currentSubject = subject;
            currentQuestions = shuffleArray(questionBank[subject]).slice(0, 20);
            userAnswers = new Array(20).fill(null);
            currentQIndex = 0;
            startTime = Date.now();
            document.getElementById('subject-title').innerText = subject.toUpperCase();
            switchSection('section-exam');
            loadQuestion(0);
            startTimer(10 * 60);
        }

        function loadQuestion(idx) {
            const q = currentQuestions[idx];
            document.getElementById('q-text').innerText = `${idx + 1}. ${q.question}`;
            document.getElementById('q-status').innerText = `${idx + 1} of 20`;
            const optsDiv = document.getElementById('options-container');
            optsDiv.innerHTML = '';
            q.options.forEach((opt, i) => {
                const checked = userAnswers[idx] === i ? 'checked' : '';
                optsDiv.innerHTML += `
                    <label class="option-label">
                        <input type="radio" name="opt" onclick="saveAns(${i})" ${checked}>
                        <span>${opt}</span>
                    </label>`;
            });
            document.getElementById('btn-next').innerText = (idx === 19) ? "Submit" : "Next";
            document.getElementById('btn-next').onclick = (idx === 19) ? submitExam : nextQuestion;
        }

        function saveAns(i) { userAnswers[currentQIndex] = i; }
        function nextQuestion() { currentQIndex++; loadQuestion(currentQIndex); }
        function prevQuestion() { if(currentQIndex > 0) { currentQIndex--; loadQuestion(currentQIndex); } }

        function startTimer(t) {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                let m = Math.floor(t / 60), s = t % 60;
                document.getElementById('time-left').textContent = `${m}:${s < 10 ? '0'+s : s}`;
                if (--t < 0) submitExam();
            }, 1000);
        }

        async function submitExam() {
            clearInterval(timerInterval);
            timeTakenSec = Math.floor((Date.now() - startTime) / 1000);
            let score = 0, missed = [];
            currentQuestions.forEach((q, i) => {
                if(userAnswers[i] === q.answer) score++;
                else if(q.topic && !missed.includes(q.topic)) missed.push(q.topic);
            });

            const resultData = {
                name: currentUser.name,
                class: currentUser.class,
                subject: currentSubject,
                score: score,
                percent: (score/20)*100,
                timeTaken: formatTime(timeTakenSec),
                date: new Date().toLocaleString()
            };

            // Send to Firebase
            try {
                await fetch("https://excellencecbt-577fb-default-rtdb.firebaseio.com/results.json", {
                    method: "POST",
                    body: JSON.stringify(resultData)
                });
            } catch(e) { console.log("Offline mode"); }

            document.getElementById('res-name').innerText = resultData.name;
            document.getElementById('res-subject').innerText = resultData.subject.toUpperCase();
            document.getElementById('res-score').innerText = score;
            document.getElementById('res-percent').innerText = resultData.percent + "%";
            
            const fb = document.getElementById('feedback-box');
            if(missed.length > 0) {
                fb.classList.remove('hidden');
                document.getElementById('topic-suggestions').innerHTML = missed.map(t => `<li>${t}</li>`).join('');
            }
            switchSection('section-result');
        }

        function formatTime(s) {
            let mins = Math.floor(s/60);
            let secs = s % 60;
            return `${mins}m ${secs}s`;
        }

        function switchSection(id) {
            document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        function shuffleArray(arr) {
            return arr.sort(() => Math.random() - 0.5);
        }
    </script>
</body>
</html>
