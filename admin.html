<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Fresh Start</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #f4f4f4; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .btn-reset { background: #dc3545; color: white; padding: 10px 20px; border: none; cursor: pointer; border-radius: 5px; font-weight: bold; }
        .btn-reset:hover { background: #a71d2a; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background: #007bff; color: white; }
    </style>
</head>
<body>

    <div class="header">
        <h2>Student Exam Records</h2>
        <button class="btn-reset" onclick="clearAllRecords()">Reset All Records</button>
    </div>

    <table id="resultsTable">
        <thead>
            <tr>
                <th>Student Name</th>
                <th>Subject</th>
                <th>Score</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            </tbody>
    </table>

    <script>
        // YOUR FIREBASE CONFIG (Paste the same config from index.html here)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_ID",
            appId: "YOUR_APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 1. Function to Load Records
        function loadRecords() {
            db.collection("examResults").orderBy("timestamp", "desc").onSnapshot((snapshot) => {
                const tableBody = document.getElementById("tableBody");
                tableBody.innerHTML = ""; 
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const row = `<tr>
                        <td>${data.name}</td>
                        <td>${data.subject.toUpperCase()}</td>
                        <td>${data.score}/20</td>
                        <td>${data.timestamp ? new Date(data.timestamp.toDate()).toLocaleString() : "N/A"}</td>
                    </tr>`;
                    tableBody.innerHTML += row;
                });
            });
        }

        // 2. Function to CLEAR ALL RECORDS
        async function clearAllRecords() {
            const secretPassword = prompt("Type 'DELETE' to clear all student records:");
            
            if (secretPassword === "DELETE") {
                const snapshot = await db.collection("examResults").get();
                const batch = db.batch();

                snapshot.docs.forEach((doc) => {
                    batch.delete(doc.ref);
                });

                await batch.commit();
                alert("Database cleared successfully! The portal is now fresh.");
            } else {
                alert("Incorrect keyword. Nothing was deleted.");
            }
        }

        loadRecords();
    </script>
</body>
</html>
